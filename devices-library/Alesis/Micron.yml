#
# Do NOT edit this file, create a <device-name>-user.yml in the same directory instead
#
deviceName: "Micron"
brand: "Alesis"
presetFormat: BANK_MSB_LSB_PRG
presetNumbering: FROM_ZERO
presetNaming: STANDARD
macros:
  # bank 0=Red, bank 1=Green, bank 2=Blue, bank 3=Yellow (user), bank 4=Edit bank
  # prg = [0-3] for edit bank, [0-127] otherwise
  - "PatchName(bank,prg) : F0 00 00 0E 26 41 bank 00 prg F7 : IonProgramMapper"

# The Ion does not use the same crazy key as the QS6.1
# It is much more classic, in fact, it is the very same than the Korg Tr-rack
#
# according to the script 'ion_program_decoder.pl' writen by Bret Victor himself in 2004
# The decoding start at position 9
# The perl code: my ($preamble, $opcode, $encoded_header, $encoded_content) = unpack "a5 N a64 a*", $sysex;
# mean:
#    a5 = Reads the first 5 bytes as an ASCII string and assigns them to $preamble.
#    N  = Reads a 4-byte unsigned long in network (big-endian) byte order and assigns it to $opcode.
#  so 5+4 => 9
decodingKey:
  start: 9
  end: 1
  key:
    - 0 G7 F7 E7 D7 C7 B7 A7
    - 0 A6 A5 A4 A3 A2 A1 A0
    - 0 B6 B5 B4 B3 B2 B1 B0
    - 0 C6 C5 C4 C3 C2 C1 C0
    - 0 D6 D5 D4 D3 D2 D1 D0
    - 0 E6 E5 E4 E3 E2 E1 E0
    - 0 F6 F5 F4 F3 F2 F1 F0
    - 0 G6 G5 G4 G3 G2 G1 G0
#
# How this device handle banks is insane.
# - On the device and in the manual there is PURPOSELY NO BANK CONCEPT (see chapter 18 page 31 'store a copy ?')
# - There is absolutely no official information on the real midi banks (Red,Green,Blue,Yellow,Edit terminology)
# - The mapping between the device memory and the control change contains holes !
# - So to get the complete list you have to brute force the 127 programs and see if the device respond to SYSEX
# The following is the result of a "brute force scan" on a ION firmware 1.10
#
deviceModes:
  Program:
    queryName: PatchName(bankLSB,program)
    midiChannels: 0
    banks:
      "Red Bank":
        command: 0
        presetDomain: 10-92;94-127
      "Green Bank":
        command: 1
        presetDomain: 0-127
      "Blue Bank":
        command: 2
        presetDomain: 0-127
      "Yellow Bank":
        command: 3
        presetDomain: 0-127
      "Edit Bank":
        command: 4
        presetDomain: 0-66;68;70-95
    categories:
      - "Recent"
      - "Faves"
      - "Bass"
      - "Synth Lead"
      - "Synth Pad"
      - "String"
      - "Brass"
      - "Keyboard"
      - "Synth Comping"
      - "Drum"
      - "Sound FX"

#
# Mappers to extract patch names
#
mappers:
  IonProgramMapper:
    fields:
      name:
        type: STRING
        offset: $38
        size: 14
      category:
        type: CATEGORY
        offset: 633 # byte 79 and 1 bit
        unit: BIT
        size: 7 # unofficial SYSEX spec say 8 bit, it is in fact 7 bits
